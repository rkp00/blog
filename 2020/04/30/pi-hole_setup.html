<h1 id="pi-hole-dns-over-https">Pi-Hole DNS over HTTPS</h1>
<p>I just set up <a href="https://en.wikipedia.org/wiki/DNS_over_HTTPS">DNS over HTTPS</a> using <a href="https://docs.pi-hole.net/guides/dns-over-https/">this guide</a> on my <a href="https://pi-hole.net">pi-hole</a> DNS sink.</p>

<p>Basically,</p>

<ol>
  <li>
    <p>Get the <a href="https://developers.cloudflare.com/1.1.1.1/dns-over-https/cloudflared-proxy/">cloudflared</a> daemon compiled for ARM (Raspberry Pi)</p>
  </li>
  <li>
    <p>Configure it as a service that runs on startup under a user named cloudflared</p>
  </li>
  <li>
    <p>Use systemd to start the service (or reboot, I guess?)</p>
  </li>
</ol>

<p>Ultimately this still goes to Cloudflare’s 1.1.1.1 DNS, except routed over HTTPS:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Commandline args for cloudflared</span>
<span class="nv">CLOUDFLARED_OPTS</span><span class="o">=</span><span class="nt">--port</span> 5053 <span class="nt">--upstream</span> https://1.1.1.1/dns-query <span class="nt">--upstream</span> https://1.0.0.1/dns-query
</code></pre></div></div>
<p>Why? Basically, with traditional HTTPS people don’t know what you are browsing (because it’s encrypted) but they can <em>definitely tell what website (domain name) you are looking at</em>.</p>

<p>Even if you are visiting a site using HTTPS, your DNS query is sent over an unencrypted connection. That means that even if you are browsing https://cloudflare.com, anyone listening to packets on the network knows you are attempting to visit cloudflare.com.</p>

<p>The second problem with unencrypted DNS is that it is easy for a Man-In-The-Middle to change DNS answers to route unsuspecting visitors to their phishing, malware or surveillance site. DNSSEC solves this problem as well by providing a mechanism to check the validity of a DNS answer, but only a single-digit percentage of domains use DNSSEC.</p>

<p>With DNS over HTTPS, a man in the middle can’t see the content, nor can they tell what website you are on. Also prevents tampering with DNS as as side benefit. <img class="emoji" title=":sweat_smile:" alt=":sweat_smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f605.png" height="20" width="20"></p>
